<!DOCTYPE html>

<head>
  
  <meta charset="utf-8">
  <style>

    path {
      
      fill: none;
      stroke-linejoin: round;
      stroke-linecap: round;
    }


    </style>

  <link rel="stylesheet" type="text/css" href="style.css">

  </head>

<body>

  <script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script>
  <script src="//d3js.org/topojson.v1.min.js"></script>
  
  <script>

    
    ///////////////////////// GET USER INPUTTED DATE /////////////////////////

    // Select the form
    // var form = d3.select("#form");

    // Create event handlers for clicking the button or pressing the enter key
    // button.on("click", runFilter);
    // form.on("submit",runFilter);

    

    ///////////////////////// LOAD IN COVID DATA /////////////////////////

    // Load in COVID data
    d3.csv("covid_data_og.csv", function(covid) {


     ///////////////////////// RUN FILTER & GRAB COVDID, LAT/LON, & TEMP DATA /////////////////////////

        // function (filtered_covid) {

        //   // ------------- GET DATE FROM FORM INPUT ------------- //

        //     // Prevent the page from refreshing
        //     d3.event.preventDefault();

        //     // Select the input element and get the raw HTML node
        //     var formInput = d3.select("#datetime");

        //     // Get the value property of the input element
        //     var inputDate = formInput.property("value");


        //     let filtered_covid = covid.filter(date => date.date === inputDate);

          // COVID cases indexed to FIPS codes
          var covidCases = {};
          covid.forEach(function(d) {
            d.cases = +d.cases
            d.FIPStxt = +d.FIPStxt
            covidCases[d.FIPStxt] = d.cases;
          })    

          // Latitutde information indexed to FIPS code
          var lat = {};
          covid.forEach(function(d) {
            d.lat = +d.lat
            d.FIPStxt = +d.FIPStxt
            lat[d.FIPStxt] = d.lat
          }) 

          // Longitude information indexed to FIPS code
          var lon = {};
          covid.forEach(function(d) {
            d.lon = +d.lon
            d.FIPStxt = +d.FIPStxt
            lon[d.FIPStxt] = d.lon
          })

          var temp = {};
          covid.forEach(function(d) {
            d.temp = +d.temp
            d.FIPStxt = +d.FIPStxt
            temp[d.FIPStxt] = d.temp
          })


          // Setting width & height for map
          var width = 960,
              height = 600;

          // Creating map projection
          var path = d3.geo.path()
              .projection(null);

          // Generating map dimensions
          var svg = d3.select("body").append("svg")
              .attr("width", width)
              .attr("height", height);

          // Function to populate county color scales
          var fill = d3.scale.log()
            .domain([10, 500])
            .range(["steelblue", "lightblue"]);

          
          // Load in GEOJSON data via json file
          d3.json("build/counties.json", function(error, us) {

            if (error) return console.error(error);

            // map out the US
            svg.append("path")
                .datum(topojson.mesh(us))
                .attr("d", path);

            // populate land features
            svg.append("path")
              .datum(topojson.feature(us, us.objects.nation))
              .attr("class", "land")
              .attr("d", path);

            // map out state borders
            svg.append("path")
                .datum(topojson.mesh(us, us.objects.counties, function(a, b) { return a !== b; }))
                .attr("class", "border border--state")
                .attr("d", path)

            // color county land masses with temperature data
            svg.append("g")
              .attr("class", "counties")
              .selectAll("path")
              .data(topojson.feature(us, us.objects.counties).features)
              .enter().append("path")
              .attr("d", path)
              .style("fill", function(d) { 
                return fill(temp[d.id]); 
              });

            // append bubbles over county center & size per covid cases
            var radius = d3.scale.sqrt()
              .domain([0, 1e6])
              .range([0, 15]);

            svg.selectAll(".bubbles")
              .data(topojson.feature(us, us.objects.counties).features)
              .enter().append("circle")
              .attr("class", "bubbles")
              .attr("r", function(d) { return radius(covidCases[d.id]*1000); })
              .attr("fill", "red")
              .attr("opacity", "0.3")
              .attr("cx", function(d) { 
                console.log(path.centroid(d.geometry)[0])
                return path.centroid(d.geometry)[0] })
              .attr("cy", function(d) { 
                console.log(path.centroid(d.geometry)[1])
                path.centroid(d.geometry)[1]
                return path.centroid(d.geometry)[1] })


           });

         
          

         // };

     });
    
   </script>

  </body>